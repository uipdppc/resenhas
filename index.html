<!-- Desenvolvido por Marcos Matos e Vinicius Coelho 2022 -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GERADOR DE RESENHAS ONLINE</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6QHDQW2J6H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-6QHDQW2J6H');
  </script>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- jQuery UI -->
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
  <!-- Timepicker Addon -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.css">
  <!-- Slider Access  -->
  <script src="https://trentrichardson.com/examples/timepicker/jquery-ui-sliderAccess.js"></script>
 
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.4/dist/umd/supabase.min.js"></script>

 
  <style>
    .register .nav-tabs .nav-link:hover {
      border: none;
    }
    .text-align {
      margin-top: 0;
      margin-bottom: 15%;
      margin-left: 30%;
    }
    .form-new {
      margin-right: 10%;
      margin-left: 10%;
    }
    .register-heading {
      position: relative;
      width: 360px;
      margin: auto;
      margin-bottom: 5%;
      color: #000000;
    }
    .register-heading h1 {
      margin-left: 20%;
      margin-bottom: 10%;
      color: #e9ecef;
    }
    .form-control {
      display: block;
      width: 100%;
      padding: 0.375rem 0.75rem;
      font-size: 1rem;
      line-height: 1.5;
      background-clip: padding-box;
      border: 2px solid #ced4da;
      border-radius: 1.25rem;
      transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
    }
    .register {
      background-image: url("img/bg_barra_circulos.jpg");
      margin: auto;
      padding: 1%;
      border-radius: 2.5rem;
    }
    .btnSubmit {
      width: 50%;
      border-radius: 1rem;
      padding: 1.5%;
      background-color: #000000;
      border: none;
      cursor: pointer;
      margin-right: 6%;
      color: rgb(246, 246, 252);
      margin-top: 4%;
    }
    .input-group {
      display: flex;
      width: 100%;
    }
    .input-group .form-control {
      border-radius: 1.25rem 0 0 1.25rem;
    }
    .input-group .btnBuscar {
      border-radius: 0 1.25rem 1.25rem 0;
      background-color: #000000;
      color: #f6f6fc;
      padding: 0.375rem 1rem;
      border: 2px solid #ced4da;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .input-group .btnBuscar:hover {
      background-color: #245996;
      color: #ffffff;
      border-color: #245996;
    }
  /* Impede que o cont√™iner de fotos seja quebrado entre p√°ginas */
  .no-break {
    page-break-inside: avoid;
    break-inside: avoid;
  }
  /* Configura as imagens para que n√£o sejam quebradas */
  #pdf-fotos img {
    display: inline-block;
    max-width: 100%;
    margin: 5px;
    page-break-inside: avoid;
    break-inside: avoid;
  }
  /* Se as imagens estiverem muito grandes, voc√™ pode for√ßar uma altura m√°xima */
  #pdf-fotos img {
    max-height: 7in; /* ajuste conforme necess√°rio */
    object-fit: contain;
  }

#pdf-resenha {
  white-space: pre-wrap;
  overflow-wrap: break-word;
  line-height: 1.5;
  word-break: break-word;
  padding-bottom: 20px;  /* Espa√ßo extra no final */
  page-break-inside: auto; 
  break-inside: auto;
}


  </style>

  <script>
    const SUPABASE_URL = "https://qtpmqwsjdsnjufngnsdz.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0cG1xd3NqZHNuanVmbmduc2R6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5MDkzMjMsImV4cCI6MjA1NTQ4NTMyM30.IM8PxNKULB3f8gwqqL_XZs2x3cNdhnd1pGTjHwLbZzc";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Verifica se h√° uma sess√£o ativa
    supabaseClient.auth.getSession().then(({ data: { session } }) => {
      if (!session) {
        alert("‚ö†Ô∏è Fa√ßa login primeiro.");
        window.location.href = "login.html";
      }
    });
  </script>

</head>

<body>
  <div class="container register">
    <div class="row">
      <div class="col-md-12">
        <div class="tab-pane fade show active text-align form-new" id="home" role="tabpanel" aria-labelledby="home-tab">
          <h3 class="register-heading text-nowrap">GERADOR DE RESENHAS</h3>
          <div class="row register-form">
            <div class="col-md-12">
              <form id="resenhaForm">
                <div class="form-group">
                  <select class="form-control" id="type" name="departamento">
                    <option value="Departamento">Selecione o Departamento</option>
                    <option value="*DECAP*">DECAP</option>
                    <option value="*DEINTER-1*">DEINTER-1</option>
                    <option value="*DEINTER-6*">DEINTER-6</option>
                    <option value="*DEIC*">DEIC</option>
                    <option value="*DPPC*">DPPC</option>
                  </select>
                  <select class="form-control" name="seccional" id="seccional2">
                    <option value="">Selecione a Seccional</option>
                  </select>
                  <select class="form-control" name="delegacia" id="delegacia2">
                    <option value="">Selecione a Unidade</option>
                  </select>
                </div>

                <div class="form-group">
                  <div class="input-group">
                    <input type="text" class="form-control" id="rdoInput" placeholder="N√∫mero do Procedimento" onkeyup="this.value = this.value.toUpperCase();" name="rdo" required>
                    <div class="input-group-append">
                      <button type="button" class="btnBuscar" onclick="buscarRDO()">üîéBuscar Registro</button>
                    </div>
                  </div>
                </div>

                <!-- Modal para selecionar registro -->
                <div id="resultadoModal" style="display: none; padding: 10px; border: 1px solid black; background-color: #f9f9f9; margin-top: 10px;">
                  <h5>Selecione um registro:</h5>
                  <ul id="resultadoLista"></ul>
                </div>

                <div class="form-group">
                  <input type="text" name="data" id="datepicker" class="form-control" placeholder="Data" required>
                </div>

                <div class="form-group">
                  <input type="text" name="natureza" class="form-control" placeholder="Natureza" onkeyup="this.value = this.value.toUpperCase();" required>
                </div>

                <div class="form-group">
                  <select class="form-control" name="ocorrencia">
                    <option value="">Selecione o tipo de ocorr√™ncia</option>
                    <option value="*FLAGRANTE*">FLAGRANTE</option>
                    <option value="*TERMO CIRCUNSTANCIADO*">TERMO CIRCUNSTANCIADO</option>
                    <option value="*BOLETIM DE OCORR√äNCIA*">BOLETIM DE OCORR√äNCIA</option>
                    <option value="*ATO INFRACIONAL*">ATO INFRACIONAL</option>
                    <option value="*PRIS√ÉO TEMPOR√ÅRIA*">PRIS√ÉO TEMPOR√ÅRIA</option>
                    <option value="*PRIS√ÉO PREVENTIVA*">PRIS√ÉO PREVENTIVA</option>
                    <option value="*MANDADO DE BUSCA E APREENS√ÉO*">MANDADO DE BUSCA E APREENS√ÉO</option>
                  </select>
                </div>

                <div class="form-group">
                  <input type="text" name="envolvidos" class="form-control" onkeyup="this.value = this.value.toUpperCase()" placeholder="ex.: 1 PRESO, 1 ADOLESCENTE INFRATOR, 2 INDICIADOS" required>
                </div>

                <div class="form-group">
                  <input type="text" name="localfato" class="form-control" onkeyup="this.value = this.value.toUpperCase();" placeholder="Endere√ßo do fato" required>
                </div>

                <div class="form-group">
                  <textarea name="historico" class="form-control" placeholder="Breve resumo da ocorr√™ncia" style="height:200px" onkeyup="this.value = this.value.toUpperCase();" required></textarea>
                </div>

                <div class="form-group">
                  <label>
                    <input type="checkbox" name="eh_operacao" id="isOperacao" onchange="toggleOperacaoFields()"> √â uma Opera√ß√£o Policial?
                  </label>
                </div>

                <div id="operacaoFields" style="display: none; border: 1px solid #ccc; padding: 10px; border-radius: 8px; margin-top: 15px;">
                  <h5>Informa√ß√µes da Opera√ß√£o</h5>
                  <!-- Campos de opera√ß√£o -->
                  <div class="form-group">
                    <label>Nome da Opera√ß√£o:</label>
                    <input type="text" class="form-control" name="nome_operacao" placeholder="Nome da Opera√ß√£o">
                  </div>
                  <div class="form-group">
                    <label>N√∫mero do Inqu√©rito Policial:</label>
                    <input type="text" class="form-control" name="numero_inquerito" placeholder="N√∫mero do Inqu√©rito">
                  </div>
                  <div class="form-group">
                    <label>Objetivo da Opera√ß√£o:</label>
                    <input type="text" class="form-control" name="objetivo_operacao" placeholder="Objetivo">
                  </div>
                  <div class="form-group">
                    <label>Efetivo Utilizado na Opera√ß√£o:</label>
                    <input type="text" class="form-control" name="efetivo_operacao" placeholder="Ex: 10 policiais">
                  </div>
                  <div class="form-group">
                    <label>Total de Viaturas Utilizadas na Opera√ß√£o:</label>
                    <input type="number" class="form-control" name="viaturas_utilizadas" placeholder="N√∫mero de viaturas">
                  </div>
                  <div class="form-group">
                    <label>Quantidade de Mandados de Busca e Apreens√£o:</label>
                    <input type="number" class="form-control" name="mandados_busca" placeholder="Quantidade">
                  </div>
                  <div class="form-group">
                    <label>Quantidade de Mandados de Pris√£o:</label>
                    <input type="number" class="form-control" name="mandados_prisao" placeholder="Quantidade">
                  </div>
                  <div class="form-group">
                    <label>Pris√µes Realizadas/Natureza Jur√≠dica/Procurado:</label>
                    <textarea class="form-control" name="prisoes_realizadas" placeholder="Ex: 2 pris√µes preventivas, 1 procurado capturado"></textarea>
                  </div>
                  <div class="form-group">
                    <label>Quantidade/Descri√ß√£o das Apreens√µes (Drogas em gramas):</label>
                    <textarea class="form-control" name="apreensoes" placeholder="Ex: 500g de coca√≠na, 1 arma de fogo"></textarea>
                  </div>
                  <div class="form-group">
                    <label>Ve√≠culos Recuperados:</label>
                    <textarea class="form-control" name="veiculos_recuperados" placeholder="Ex: 2 motocicletas, 1 carro"></textarea>
                  </div>
                  <div class="form-group">
                    <label>Outros:</label>
                    <textarea class="form-control" name="outros" placeholder="Outras informa√ß√µes relevantes"></textarea>
                  </div>
                </div>

                <div class="form-group">
                  <label for="fotoUpload">üì∑ Upload de Fotos:</label>
                  <input type="file" class="form-control" id="fotoUpload" multiple accept="image/*">
                  <input type="button" class="btnSubmit btn-block" value="üì§ Enviar Fotos" onclick="uploadFotos()">
                </div>

                <div id="fotosPreview" style="margin-top: 10px;"></div>

                <div class="form-group">
                  <input type="button" class="btnSubmit btn-block" value="üßπ Limpar Formul√°rio" onclick="resetFormulario()">
                </div>

                <div class="form-group">
                  <input type="submit" class="btnSubmit btn-block" value="Gerar Resenha e Salvar">
                </div>

  		<div class="form-group">
		<input type="button" id="gerar-pdf" class="btnSubmit btn-block" value="Gerar PDF - Formul√°rio Opera√ß√£o">
		</div>
              </form>
              <br>
              <div id="resultado" style="border: solid black 2px;">
                <p><b>*Pol√≠cia Civil*</b></p>
                <p><b id="departamento"></b></p>
                <p><b id="seccional"></b></p>
                <p><b id="delegacia"></b></p>
                <p id="rdo"></p>
                <p id="data"></p>
                <p id="natureza"></p>
                <p><b id="ocorrencia"></b></p>
                <p id="envolvidos"></p>
                <p id="localfato"></p>
                <p id="historico"></p>
              </div>
              <div class="form-group">
                <input type="button" class="btnSubmit btn-block" value="Encaminhar via WhatsApp" onclick="gotowhatsapp()">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<!-- Template do PDF (oculto) -->
<div id="pdf-content" style="display: none; font-family: Arial, sans-serif; font-size: 12px; padding: 0px 20px 20px 20px;">
  <table style="width: 100%; border-collapse: collapse; margin-top: 0;">
     <tbody>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Departamento</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-departamento"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Delegacia Seccional</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-seccional"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Unidade da Ocorr√™ncia</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-delegacia"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Nome da Opera√ß√£o</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-operacao"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Data da Ocorr√™ncia</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-data"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">N√∫mero do RDO</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-rdo"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">N√∫mero do Inqu√©rito Policial</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-inquerito"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Endere√ßo da Ocorr√™ncia</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-endereco"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Objetivo da Ocorr√™ncia</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-objetivo"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Efetivo Utilizado</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-efetivo"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Total de Viaturas</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-viaturas"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Mandados de Busca</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-mandados-busca"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Mandados de Pris√£o</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-mandados-prisao"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Pris√£o Realizada / Natureza Jur√≠dica</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-prisoes"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Apreens√µes (drogas em gramas)</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-apreensoes"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Ve√≠culos Recuperados</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-veiculos"></td>
      </tr>
      <tr>
        <td style="border: 1px solid #000; padding: 5px;">Outros</td>
        <td style="border: 1px solid #000; padding: 5px;" id="pdf-outros"></td>
      </tr>
<tr>
  <td colspan="2" style="border: 1px solid #000; padding: 5px; text-align: CENTER;"><strong>RESENHA DA OCORR√äNCIA</strong></td>
</tr>
<tr>
  <td colspan="2" style="border: 1px solid #000; padding: 5px;">
    <div id="pdf-resenha" style="white-space: pre-wrap; overflow-wrap: break-word; line-height: 1.5;">
  </td>
</tr>
    </tbody>
  </table>
<div id="pdf-fotos-container" style="margin-top: 20px; text-align: center; page-break-inside: avoid; break-inside: avoid;">
  <h3 id="pdf-fotos-titulo" style="text-align: center; margin-bottom: 10px;">Fotos da Opera√ß√£o</h3>
  <div id="pdf-fotos"></div>

    

</div>



    <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>

    <script src="script.js"></script>

</body>
</html>


